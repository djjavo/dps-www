<?php
class Tweet {

    protected $username;    
    protected $title;
    protected $description;
    protected $guid;
    protected $link;
    protected $date;
    protected $source;
    protected $place;

    public function get_username()    { return $this->username; }
    public function get_title()       { return $this->title; }
    public function get_description() { return $this->description; }
    public function get_guid()        { return $this->guid; }
    public function get_link()        { return $this->link; }
    public function get_date()        { return $this->date; }
    public function get_source()      { return $this->source; }
    public function get_place()       { return $this->place->name; }
    public function get_place_full()  { return $this->place->full_name; }

    public function get_fuzzytime()
    {
        $diff = time() - $this->time;
        $periods = array("second", "minute", "hour", "day", "week", "month", "year", "decade");
        $lengths = array("60","60","24","7","4.35","12","10");
        for($j = 0; $diff >= $lengths[$j] && $j < count($lengths)-1; $j++)
        {
            $diff /= $lengths[$j];
        }
        $diff = round($diff);
        if($diff != 1)
        {
            $periods[$j].= "s";
        }
        return "about $diff $periods[$j] ago";
    }

    public function set_username($val)    { $this->username = $val; }
    public function set_title($val)       { $this->title = $val; }
    public function set_description($val) { $this->description = $val; }
    public function set_guid($val)        { $this->guid = $val; }
    public function set_link($val)        { $this->link = $val; }
    public function set_date($val)        { $this->date = strtotime($val); }
    public function set_source($val)      { $this->source = $val; }
    public function set_place($val)       { $this->place = $val; }

    public function parse_links() {
        $str = $this->description;
        $str = preg_replace("/(^|[\n ])([\w]*?)((ht|f)tp(s)?:\/\/[\w]+[^ \,\"\n\r\t<]*)/is", "$1$2<a href=\"$3\" >$3</a>", $str);
        $str = preg_replace("/(^|[\n ])([\w]*?)((www|ftp)\.[^ \,\"\t\n\r<]*)/is", "$1$2<a href=\"http://$3\" >$3</a>", $str);
        $str = preg_replace("/(^|[\n ])([a-z0-9&\-_\.]+?)@([\w\-]+\.([\w\-\.]+)+)/i", "$1<a href=\"mailto:$2@$3\">$2@$3</a>", $str);
        $str = preg_replace("/@(\w+)/", '<a href="http://www.twitter.com/$1" target="_blank">@$1</a>', $str);
        $str = preg_replace("/\#(\w+)/", '<a href="http://search.twitter.com/search?q=$1" target="_blank">#$1</a>',$str);
        $str = substr($str,strpos($str,":")+2);
	$this->description = $str;
	return 0;
    }
}
