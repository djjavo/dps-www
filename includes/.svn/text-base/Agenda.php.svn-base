<?php
class Agenda {
	protected $meeting_time;
	protected $meeting_id;
	public $agendaItems;
	
	function __construct($meeting_id){
		$this->meeting_id = $meeting_id;
		$this->retriveItems();
		$result = RawDB::query("SELECT meeting_time FROM web_meetings WHERE meeting_id = '".$this->meeting_id."'");
		$row = pg_fetch_row($result);
		$this->meeting_time = $row[0];
	}
	
	public function getMeetingTime(){
		return $this->meeting_time;
	}
	public function getMeetingID(){
		return $this->meeting_id;
	}
	
	protected function retriveItems(){
		$this->agendaItems = NULL;
		$result = RawDB::query("SELECT * FROM web_agenda_items WHERE meeting_id = '".$this->meeting_id."'");
		while($object = pg_fetch_object($result, NULL, 'AgendaItem', array($this->meeting_id)))
			$this->agendaItems[] = $object;
		if(count($this->agendaItems) == 0)
			$this->agendaItems = false;
	}
	public function addItem(){
		$this->agendaItems[] = new AgendaItem($this->meeting_id);
		end($this->agendaItems);
		return current($this->agendaItems);
	}
	public function removeItem($index){
		if(array_key_exists($this->agendaItems[$index])){
			if(!$this->agendaItems[$index]->delete()){
				trigger_error("Item could not be deleted", E_USER_ERROR);
				return false;
			}
			array_slice($this->agendaItems,$index,1);
			return true;
		} else {
			trigger_error("Item does not exist.", E_USER_ERROR);
			return false;
		}
	}
	
	public function save(){
		foreach ($this->agendaItems as $item){
			$item->save();
		}
	}
}