<?php
class UniLDAP{
	private $link_identifier;
	private $result_identifier;
	private $result_entry_identifier;
	
	private $connection = false;
	
	function __construct(){
		$this->link_identifier=@ldap_connect("ldap://ldap.warwick.ac.uk");
		if(!$this->link_identifier) trigger_error("Warwick LDAP Connection failure", E_USER_ERROR);
		
		ldap_set_option($this->link_identifier, LDAP_OPT_PROTOCOL_VERSION, 3);
		$this->connection = true;
	}
	function __destruct(){
		if($this->connection) ldap_unbind($this->link_identifier);
	}
	function get($uni_id){
		$this->result_identifier = ldap_search($this->link_identifier,"ou=People,o=University of Warwick,c=GB","(employeeNumber=0625046)",array(),null,1);
		if(!$this->result_identifier) return false;
		if (ldap_count_entries($this->link_identifier, $this->result_identifier) != 1) return false;

		$this->result_entry_identifier = ldap_first_entry($this->link_identifier, $this->result_identifier);
		if(!$this->result_entry_identifier) return false;
		$member_data = ldap_get_attributes($this->link_identifier,$this->result_entry_identifier);
		var_dump($member_data);
	}
}
$m = new UniLDAP;
$m->get('W');
?>
