<?php
class SpaceTemplate implements Template{
	protected static $menu;
	public static function get_menu(){
		if(!isset(self::$menu)) self::$menu = new Menu;
		return self::$menu;
	}
	public static function print_page($content){
		$main_menu = new Menu;
		$main_menu->add_many(
			array("index.php","Home"),
			array("shows","Shows"),
			array("music","Music"),
			array("about","About"),
			array("contact","Contact"));
	$site_path_array = explode("/",SITE_PAGE);
	$main_menu->set_active($site_path_array[0]);
	
	$return = "
<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\"
                      \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">
<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"en\" xml:lang=\"en\">
<head>
	<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\" />
	<title>RaWspace";
	if(Output::get_title() != 'Untitled Page')
		$return .= " - ".Output::get_title();
	$return .= "</title>
	<link rel=\"stylesheet\" href=\"".SITE_LINK_REL."space/css/style.css\" type=\"text/css\" media=\"screen\" />";
	if(count(Output::get_stylesheets())>0)
		foreach(Output::get_stylesheets() AS $src){
			$return .= "\n	<link href=\"".$src."\" rel=\"stylesheet\" type=\"text/css\"/>";
		}
	$return .= "\n  <script src=\"".SITE_LINK_REL."js/jquery/jquery-1.3.2.js\" type=\"text/javascript\"></script>";
	if(count(Output::get_scripts())>0)
		foreach(Output::get_scripts() AS $src){
			$return .= "\n	<script src=\"".$src."\" type=\"text/javascript\"></script>";
		}
	$show = Shows::current();
	$showname = htmlentities(Truncate::words($show->get_name(),60));
	$return .= "
</head>

<div id=\"wrapper\">
			
		<div id=\"header\">
			<a href=\"".SITE_LINK_REL."\"><img src=\"".SITE_LINK_REL."space/images/template/header_logo.jpg\" id=\"header_logo\" alt=\"RaW 1251AM\" /></a>
			".$main_menu->output(SITE_LINK_REL,3,"header_tabs")."
			<div id=\"header_user\">"; if(Session::is_member()){ $return .= "Welcome ".ucwords(Session::get_nick())." - <a href=\"".SITE_LINK_REL."space\">RaWspace Home</a> - <a href=\"".SITE_LINK_REL."space/logout.php\">Log Out</a>"; } else { $return .= "<a href=\"".SITE_LINK_REL."space\">RaWspace Home</a> - <a href=\"".SITE_LINK_REL."space/login.php?referal=".SITE_PAGE.(count($_GET)>0?"&amp;".http_build_query($_GET):"")."\">Log In</a>"; } $return .= "</div>
			<div id=\"header_bar\">
			
				<ul id=\"header_bar_links\">
					<li><a href=\"".SITE_LINK_REL."listen\">Listen Now</a></li>
					<li><a href=\"".SITE_LINK_REL."watch\">Webcams</a></li>
					<li><a href=\"".SITE_LINK_REL."listen/moreraw\">MoreRaW</a></li>
				</ul>
				
				<p id=\"header_bar_onair\">On Air:
                ".date("ga",$show->get_start())."-".date("ga",$show->get_end())."
                <a
                href=\"".SITE_LINK_REL."shows/".$show->get_showid()."\">".ucwords($showname)."</a></p>
				
				<div id=\"header_bar_onair_image\">
					<a href=\"".SITE_LINK_REL."shows/".$show->get_showid()."\"><img src=\"".SITE_LINK_MEDIA."shows/".$show->get_image()."\" alt=\"".$showname."\" /></a>
				</div>
				
			</div>
			
		</div>
	
		<div id=\"content\">
<h1>RaWspace</h1>
	<div id=\"page_menu\">

".self::$menu->output(SITE_LINK_REL."space/")."\n<ul id=\"loginout\"><li>";

if(Session::is_member())
	$return .= "<a href=\"".SITE_LINK_REL."space/logout.php\">Log Out</a>";
else
	$return .= "<a href=\"".SITE_LINK_REL."space/login.php?referal=".SITE_PAGE.(count($_GET)>0?"&".http_build_query($_GET):"")."\">Log In</a>";
$return .= "</li><ul></div>
	<div id=\"page_content\">";

$return .= $content;

if(Errors::occured()){
	$return .= "\n<div id=\"errors\">";
	$return .= "\n<h3>Error Occured!</h3>";
	if(Errors::total()==1)	$return .= "\n<p>An error has occured during the running of this page</p>";
	else					$return .= "\n<p>".Errors::total()." errors have occured during the running of this page</p>";
	
	$return .= "\n<textarea cols=\"100\" rows=\"6\">";
	$return .=Errors::report();
	$return .= "\n</textarea>";
	$return .= "\n</div>";
}

$return .= "
</div>

<div class=\"clear\"></div>
			</div>
		
		<div id=\"footer\">
			<p>Radio Warwick &copy; ".date("Y")."</p>
		</div>
		
	</div>
	<script type=\"text/javascript\" src=\"http"; if (isset($_SERVER['HTTPS']))
{ $return .= 's://ssl'; } else { $return .= '://www'; } $return .= ".google-analytics.com/ga.js\"></script>
	<script type=\"text/javascript\">
		var pageTracker = _gat._getTracker(\"UA-4483020-1\");
		pageTracker._initData();
		pageTracker._trackPageview();
	</script>
</body>

</html>";
	return $return;
	}
	public static function print_http_error($error_code){
		switch($error_code){
			case 401: return "<h1>Unauthorized</h1>\n<p>This page requires special permissions</p>"; break;
			case 404: return "<h1>Page not found</h1>\n<p>This page does not exist in Space</p>"; break;
		}
	}
}
?>
