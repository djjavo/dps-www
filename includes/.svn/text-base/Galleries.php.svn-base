<?php
class Galleries{

	public static function get($gallery_id){
		$result = RawDB::query("SELECT web_photos_galleries.* FROM web_photos_galleries
		WHERE web_photos_galleries.gallery_id = '".$gallery_id."'");
		
		return pg_fetch_object($result,null,'Gallery');

	}
	public static function get_you_are_here($gallery_id_array){
		$array = $return = array();
		foreach(self::get_several($gallery_id_array) AS $object)
			$array[$object->get_gallery_id()] = $object;
		foreach($gallery_id_array AS $id)
			$return[] = $array[$id];
		return $return;
	}
	public static function get_several($gallery_id_array){
		$gallery_id_array = array_unique($gallery_id_array);
		
		$result = RawDB::query("SELECT web_photos_galleries.* FROM web_photos_galleries
		WHERE web_photos_galleries.gallery_id IN ('".implode("','",$gallery_id_array)."')");
		
		if(pg_num_rows($result) != count($gallery_id_array)) throw new UserError("Not all galleries were found!");
		$array = array();
		while($object = pg_fetch_object($result,null,'Gallery'))
			$array[] = $object;
		return $array;
	}
	public static function check_path($gallery_id_array){
		if(count($gallery_id_array)<2) trigger_error("Incorrect use of check_path. Expecting array of size >= 2",E_USER_ERROR);
		$query = "SELECT";
		
		$array = array(" t0.parent_gallery_id AS l0");
		for($i = 1; $i < count($gallery_id_array); $i++)
			$array[] = " t".($i-1).".child_gallery_id AS l".$i;
		$query .= implode(",",$array);
		
		$query .= "\nFROM web_photos_galleries_in_galleries AS t0\n";
		for($i = 1; $i < count($gallery_id_array) - 1; $i++)
			$query .= "LEFT JOIN web_photos_galleries_in_galleries AS t".$i." ON t".$i.".parent_gallery_id = t".($i-1).".child_gallery_id\n";
		
		$query .= "WHERE t0.parent_gallery_id  = '".$gallery_id_array[0]."'\n";
		for($i = 1; $i < count($gallery_id_array); $i++)
		$query .= "AND t".($i-1).".child_gallery_id = '".$gallery_id_array[$i]."'\n";
		
		return count(pg_fetch_assoc(RawDB::query($query))) == count($gallery_id_array);
		
	}
}
?>