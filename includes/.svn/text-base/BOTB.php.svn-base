<?php

class BOTB {
	public static function getHeat($heatID)
	{
		if(is_numeric($heatID))
		{
			$query = "SELECT * FROM web_botb_heats WHERE id = '".$heatID."'";
			$result = RawDB::query($query);
			return pg_fetch_object($result, null, "BOTBHeat");
		} else
			return false;
	}
 
	public static function getAllHeats($year = null)
	{
		if(is_null($year))
			$year = date("Y");
		elseif (!is_numeric($year) && ($year < 2000 || $year > 2100))
			return false;
		$return = array();
		$query = "SELECT * FROM web_botb_heats WHERE date BETWEEN '".pg_escape_string($year)."-01-01 00:00:00+00' AND '".pg_escape_string($year+1)."-12-12 00:00:00+00' ORDER BY number ASC";
		$result = RawDB::query($query);
		while( $object = pg_fetch_object($result, null, "BOTBHeat"))
			$return[] = $object;
		return $return;
	}
	
	public static function getAllBands($archive = false)
	{
		if(!is_bool($archive))
			$archive = false;		
		$return = array();
		$query = "SELECT * FROM web_botb_bands".(($archive)?"":" WHERE active=True")." ORDER BY name ASC";
		$result = RawDB::query($query);
		while( $object = pg_fetch_object($result, null, "BOTBHeat"))
			$return[] = $object;
		return $return;
	}
	
	public static function getBand($bandID)
	{
		if(is_numeric($bandID))
		{
			$query = "SELECT * FROM web_botb_bands WHERE id = '".$bandID."'";
			$result = RawDB::query($query);
			return pg_fetch_object($result, null, "BOTBBand");
		} else
			return false;
	}
	public static function latestYear()
	{
		$query = "SELECT date FROM web_botb_heats ORDER BY date ASC LIMIT 1";
		$result = RawDB::query($query);
		$row = pg_fetch_row($result);
		$date = new DateTime($row[0]);
		return $date->format("Y");
	}
	
	public static function archive()
	{
		//write shit here to archive old botbs, files, bands, everything
	}
}

?>
