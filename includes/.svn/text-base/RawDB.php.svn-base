<?php
/**
 * RaW Website Database Class
 * 
 * Provides methods to connect to and query the website database.
 * @package RaWWebsite
 * @author William Dangerfield
 */
class RawDB{
	protected static $pgresource;

	/**
	 * Log of executed queries
	 */
	protected static $log = array();

	/**
	 * Connect to the database
	 * @return pgresource PostgreSQL connection resource
	 */
	public static function connect(){;
		self::$pgresource = pg_connect("host=". DATABASE_WEB_HOST ." port=". DATABASE_WEB_PORT ." dbname=". DATABASE_WEB_NAME);
		self::is_connected();
		return self::$pgresource;
	}

	/**
	 * Return connection resource
	 * @return pgresource PostgreSQL connection resource
	 */
	public static function resource(){
		return self::$pgresource;
	}

	/**
	 * Check whether database is connected
	 * @return bool TRUE if connected, FALSE if not
	 */
	protected static function is_connected(){
		if(!self::$pgresource){
			trigger_error("No Connection to database", E_USER_ERROR);
			return false;
		}else if (pg_connection_status(self::$pgresource)==PGSQL_CONNECTION_BAD){
			trigger_error("Database connection bad",E_USER_ERROR);
			return false;
		}
		return true;
	}

	/**
	 * Execute PostgreSQL query
	 * @return pgqueryresource Query result resource on success, or FALSE on failure
	 */
	public static function query($query){
		if(self::is_connected()){
			self::$log[] = $query;
			return pg_query(self::$pgresource,$query);
		}
		
	}

	/**
	 * Return log of executed queries
	 * @return array Log of executed queries
	 */
	public static function get_log(){
		return self::$log;
	}
}
RawDB::connect();
?>
